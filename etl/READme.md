# Построение ETL-пайплайна

Продолжим развивать идею из лекции и решим чуть более усложнённый вариант ETL задачи. Ожидается, что на выходе будет DAG в airflow, который будет считаться каждый день за вчера. 

1. Параллельно будем обрабатывать две таблицы. В feed_actions для каждого юзера посчитаем число просмотров и лайков контента. В message_actions для каждого юзера считаем, сколько он получает и отсылает сообщений, скольким людям он пишет, сколько людей пишут ему. Каждая выгрузка должна быть в отдельном таске.

2. Далее объединяем две таблицы в одну.

3. Для этой таблицы считаем все эти метрики в разрезе по полу, возрасту и ос. Делаем три разных таска на каждый срез.

4. И финальные данные со всеми метриками записываем в отдельную таблицу в ClickHouse.

5. Каждый день таблица должна дополняться новыми данными. 

Структура финальной таблицы должна быть такая:

- Дата - event_date

- Название среза - dimension

- Значение среза - dimension_value

- исло просмотров - views

- Числой лайков - likes

- Число полученных сообщений - messages_received

- Число отправленных сообщений - messages_sent

- От скольких пользователей получили сообщения - users_received

- Скольким пользователям отправили сообщение - users_sent

*Срез - это os, gender и age*

Вашу таблицу необходимо загрузить в схему test, ответ на это задание - название Вашей таблицы в схеме test


## Данные

**simulator.feed_actions** — таблица c действиями пользователей в ленте

- user_id - идентификатор пользователя
- post_id - идентификатор поста
- action - действие пользователя (like, view)
- time - время
- gender - пол
- age - возраст
- country - страна
- city - город
- os - операционная система
- source - источник (organic, ads)
- exp_group - номер експерементальной группы

**simulator.message_actions** — таблица c действиями пользователей в сообщениях

- user_id - идентификатор отправителя
- reciever_id - идентификатор получателя
- source - источник (organic, ads)
- exp_group - номер експерементальной группы
- gender - пол
- age - возраст
- country - страна
- city - город
- os - операционная система